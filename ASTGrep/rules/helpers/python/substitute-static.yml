# yaml-language-server: $schema=https://raw.githubusercontent.com/ast-grep/ast-grep/main/schemas/rule.json

id: python-substitute-static-vars
message: Substitute static variables
language: Python
rule:
  any:
    - all:
        - kind: assignment
        - has:
            field: left
            kind: identifier
            pattern: $VAR
        - has:
            field: right
            matches: static
        - not:
            matches: precedes_assignment
    - all:
        - kind: identifier
          pattern: $VAR
          inside:
            any:
              - kind: pattern_list
              - kind: tuple_pattern
            all:
              - inside:
                  kind: assignment
                  field: left
              - inside:
                  kind: assignment
                  has:
                    field: right
                    any:
                      - kind: expression_list
                      - kind: tuple
              - not:
                  matches: precedes_assignment
        - any:
            - nthChild: 1
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 1
                      matches: static
            - nthChild: 2
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 2
                      matches: static
            - nthChild: 3
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 3
                      matches: static
            - nthChild: 4
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 4
                      matches: static
            - nthChild: 5
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 5
                      matches: static
            - nthChild: 6
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 6
                      matches: static
            - nthChild: 7
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 7
                      matches: static
            - nthChild: 8
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 8
                      matches: static
            - nthChild: 9
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 9
                      matches: static
            - nthChild: 10
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 10
                      matches: static
            - nthChild: 11
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 11
                      matches: static
            - nthChild: 12
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 12
                      matches: static
            - nthChild: 13
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 13
                      matches: static
            - nthChild: 14
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 14
                      matches: static
            - nthChild: 15
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 15
                      matches: static
            - nthChild: 16
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 16
                      matches: static
            - nthChild: 17
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 17
                      matches: static
            - nthChild: 18
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 18
                      matches: static
            - nthChild: 19
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 19
                      matches: static
            - nthChild: 20
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 20
                      matches: static
            - nthChild: 21
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 21
                      matches: static
            - nthChild: 22
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 22
                      matches: static
            - nthChild: 23
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 23
                      matches: static
            - nthChild: 24
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 24
                      matches: static
            - nthChild: 25
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 25
                      matches: static
            - nthChild: 26
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 26
                      matches: static
            - nthChild: 27
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 27
                      matches: static
            - nthChild: 28
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 28
                      matches: static
            - nthChild: 29
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 29
                      matches: static
            - nthChild: 30
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 30
                      matches: static
            - nthChild: 31
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 31
                      matches: static
            - nthChild: 32
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 32
                      matches: static
            - nthChild: 33
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 33
                      matches: static
            - nthChild: 34
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 34
                      matches: static
            - nthChild: 35
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 35
                      matches: static
            - nthChild: 36
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 36
                      matches: static
            - nthChild: 37
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 37
                      matches: static
            - nthChild: 38
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 38
                      matches: static
            - nthChild: 39
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 39
                      matches: static
            - nthChild: 40
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 40
                      matches: static
            - nthChild: 41
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 41
                      matches: static
            - nthChild: 42
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 42
                      matches: static
            - nthChild: 43
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 43
                      matches: static
            - nthChild: 44
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 44
                      matches: static
            - nthChild: 45
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 45
                      matches: static
            - nthChild: 46
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 46
                      matches: static
            - nthChild: 47
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 47
                      matches: static
            - nthChild: 48
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 48
                      matches: static
            - nthChild: 49
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 49
                      matches: static
            - nthChild: 50
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 50
                      matches: static
            - nthChild: 51
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 51
                      matches: static
            - nthChild: 52
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 52
                      matches: static
            - nthChild: 53
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 53
                      matches: static
            - nthChild: 54
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 54
                      matches: static
            - nthChild: 55
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 55
                      matches: static
            - nthChild: 56
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 56
                      matches: static
            - nthChild: 57
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 57
                      matches: static
            - nthChild: 58
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 58
                      matches: static
            - nthChild: 59
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 59
                      matches: static
            - nthChild: 60
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 60
                      matches: static
            - nthChild: 61
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 61
                      matches: static
            - nthChild: 62
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 62
                      matches: static
            - nthChild: 63
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 63
                      matches: static
            - nthChild: 64
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 64
                      matches: static
            - nthChild: 65
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 65
                      matches: static
            - nthChild: 66
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 66
                      matches: static
            - nthChild: 67
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 67
                      matches: static
            - nthChild: 68
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 68
                      matches: static
            - nthChild: 69
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 69
                      matches: static
            - nthChild: 70
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 70
                      matches: static
            - nthChild: 71
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 71
                      matches: static
            - nthChild: 72
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 72
                      matches: static
            - nthChild: 73
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 73
                      matches: static
            - nthChild: 74
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 74
                      matches: static
            - nthChild: 75
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 75
                      matches: static
            - nthChild: 76
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 76
                      matches: static
            - nthChild: 77
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 77
                      matches: static
            - nthChild: 78
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 78
                      matches: static
            - nthChild: 79
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 79
                      matches: static
            - nthChild: 80
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 80
                      matches: static
            - nthChild: 81
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 81
                      matches: static
            - nthChild: 82
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 82
                      matches: static
            - nthChild: 83
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 83
                      matches: static
            - nthChild: 84
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 84
                      matches: static
            - nthChild: 85
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 85
                      matches: static
            - nthChild: 86
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 86
                      matches: static
            - nthChild: 87
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 87
                      matches: static
            - nthChild: 88
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 88
                      matches: static
            - nthChild: 89
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 89
                      matches: static
            - nthChild: 90
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 90
                      matches: static
            - nthChild: 91
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 91
                      matches: static
            - nthChild: 92
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 92
                      matches: static
            - nthChild: 93
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 93
                      matches: static
            - nthChild: 94
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 94
                      matches: static
            - nthChild: 95
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 95
                      matches: static
            - nthChild: 96
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 96
                      matches: static
            - nthChild: 97
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 97
                      matches: static
            - nthChild: 98
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 98
                      matches: static
            - nthChild: 99
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 99
                      matches: static
            - nthChild: 100
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 100
                      matches: static
            - nthChild: 101
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 101
                      matches: static
            - nthChild: 102
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 102
                      matches: static
            - nthChild: 103
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 103
                      matches: static
            - nthChild: 104
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 104
                      matches: static
            - nthChild: 105
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 105
                      matches: static
            - nthChild: 106
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 106
                      matches: static
            - nthChild: 107
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 107
                      matches: static
            - nthChild: 108
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 108
                      matches: static
            - nthChild: 109
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 109
                      matches: static
            - nthChild: 110
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 110
                      matches: static
            - nthChild: 111
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 111
                      matches: static
            - nthChild: 112
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 112
                      matches: static
            - nthChild: 113
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 113
                      matches: static
            - nthChild: 114
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 114
                      matches: static
            - nthChild: 115
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 115
                      matches: static
            - nthChild: 116
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 116
                      matches: static
            - nthChild: 117
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 117
                      matches: static
            - nthChild: 118
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 118
                      matches: static
            - nthChild: 119
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 119
                      matches: static
            - nthChild: 120
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 120
                      matches: static
            - nthChild: 121
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 121
                      matches: static
            - nthChild: 122
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 122
                      matches: static
            - nthChild: 123
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 123
                      matches: static
            - nthChild: 124
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 124
                      matches: static
            - nthChild: 125
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 125
                      matches: static
            - nthChild: 126
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 126
                      matches: static
            - nthChild: 127
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 127
                      matches: static
            - nthChild: 128
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 128
                      matches: static
            - nthChild: 129
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 129
                      matches: static
            - nthChild: 130
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 130
                      matches: static
            - nthChild: 131
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 131
                      matches: static
            - nthChild: 132
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 132
                      matches: static
            - nthChild: 133
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 133
                      matches: static
            - nthChild: 134
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 134
                      matches: static
            - nthChild: 135
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 135
                      matches: static
            - nthChild: 136
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 136
                      matches: static
            - nthChild: 137
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 137
                      matches: static
            - nthChild: 138
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 138
                      matches: static
            - nthChild: 139
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 139
                      matches: static
            - nthChild: 140
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 140
                      matches: static
            - nthChild: 141
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 141
                      matches: static
            - nthChild: 142
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 142
                      matches: static
            - nthChild: 143
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 143
                      matches: static
            - nthChild: 144
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 144
                      matches: static
            - nthChild: 145
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 145
                      matches: static
            - nthChild: 146
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 146
                      matches: static
            - nthChild: 147
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 147
                      matches: static
            - nthChild: 148
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 148
                      matches: static
            - nthChild: 149
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 149
                      matches: static
            - nthChild: 150
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 150
                      matches: static
            - nthChild: 151
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 151
                      matches: static
            - nthChild: 152
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 152
                      matches: static
            - nthChild: 153
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 153
                      matches: static
            - nthChild: 154
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 154
                      matches: static
            - nthChild: 155
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 155
                      matches: static
            - nthChild: 156
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 156
                      matches: static
            - nthChild: 157
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 157
                      matches: static
            - nthChild: 158
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 158
                      matches: static
            - nthChild: 159
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 159
                      matches: static
            - nthChild: 160
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 160
                      matches: static
            - nthChild: 161
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 161
                      matches: static
            - nthChild: 162
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 162
                      matches: static
            - nthChild: 163
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 163
                      matches: static
            - nthChild: 164
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 164
                      matches: static
            - nthChild: 165
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 165
                      matches: static
            - nthChild: 166
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 166
                      matches: static
            - nthChild: 167
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 167
                      matches: static
            - nthChild: 168
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 168
                      matches: static
            - nthChild: 169
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 169
                      matches: static
            - nthChild: 170
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 170
                      matches: static
            - nthChild: 171
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 171
                      matches: static
            - nthChild: 172
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 172
                      matches: static
            - nthChild: 173
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 173
                      matches: static
            - nthChild: 174
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 174
                      matches: static
            - nthChild: 175
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 175
                      matches: static
            - nthChild: 176
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 176
                      matches: static
            - nthChild: 177
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 177
                      matches: static
            - nthChild: 178
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 178
                      matches: static
            - nthChild: 179
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 179
                      matches: static
            - nthChild: 180
              inside:
                inside:
                  has:
                    field: right
                    has:
                      nthChild: 180
                      matches: static

  not:
    inside:
      stopBy: end
      any:
        - kind: except_clause
        # - kind: if_statement
        - follows:
            kind: global_statement
            stopBy: end
            has:
              kind: identifier
              pattern: $VAR

  all:
    - any:
        - inside:
            stopBy: end
            kind: function_definition
            has:
              field: name
              pattern: $FUNCTION
        - not:
            inside:
              stopBy: end
              kind: function_definition
    - any:
        - inside:
            stopBy: end
            kind: if_statement
            has:
              field: condition
              pattern: $IF_CONDITION
        - not:
            inside:
              kind: if_statement
utils:
  static:
    pattern: $VALUE
    any:
      - kind: integer
      - kind: "true"
      - kind: "false"
      - kind: float
      - kind: string
        not:
          has:
            kind: interpolation
      - kind: "none"
      - kind: identifier
        not:
          # Handled by renamed-builtin ->  TODO: merge both!
          any:
            - pattern: eval
            - pattern: exec
            - pattern: str
            - pattern: map
            - pattern: ord
            - pattern: tuple
            - pattern: type
            - pattern: globals
            - pattern: locals
            - pattern: __import__
            - pattern: compile
            - pattern: getattr
            - pattern: dir
            - pattern: vars
            - pattern: bool
            - pattern: float
            - pattern: int
            - pattern: bytes
            - pattern: list
            - pattern: pow
            - pattern: round
            - pattern: range
            - pattern: open
            - pattern: chr
            - pattern: request
            - pattern: getenv
            - pattern: listdir
            - pattern: exit
            - pattern: choice
            - pattern: system
            - pattern: winreg
            - pattern: base64
            - pattern: gc.get_referents
            # TODO: better patterns
            # - pattern: "''.join"
            - pattern: binascii.unhexlify

  # This prevents replacing variables that are later changed,
  # but only in the function definitions - we should change it
  # to be more generic and just ensure replacement BEFORE the next
  # assignment or augmented assignment.
  precedes_assignment:
    inside:
      stopBy: end
      kind: expression_statement
      inside:
        stopBy: end
        kind: function_definition
        # Optimization? shortcut - skip checking which function
        has:
          field: name
          pattern: $FUNCTION
      precedes:
        # kind: expression_statement
        stopBy: end
        has:
          stopBy: end
          any:
            - kind: augmented_assignment
            - kind: assignment
          has:
            field: left
            any:
              - kind: identifier
                pattern: $VAR
              - kind: pattern_list
                has:
                  kind: identifier
                  pattern: $VAR

metadata:
  extended-obfuscation: no
  alone-unimportant: yes
  score: 0
  template_file: python-replace-static-var.yml.j2
  tpl_in_function: FUNCTION
  deobfuscate: |
    {
      "type": "template",
      "steps": [],
      "fix-key": "VAR",
      "override-fix": true,
      "persistent": true,
      "persistent-key": "VAR",
      "persistent-value": "VALUE"
    }
